



<!DOCTYPE html>
<html class="no-js">
	<head>
		
	
			
			<meta charset="utf-8">
			<meta name="viewport" content="width=device-width, initial-scale=1">
			<meta http-equiv="X-UA-Compatible" content="IE=edge" />
			<meta property="og:site_name" content="Little Weaver Web Collective"/>
			<meta property="og:url" content="https://littleweaverweb.com/blog/query-count-pitfalls-and-how-avoid-them/" />
			<meta property="og:title" content="Query count pitfalls and how to avoid them
" />
			<meta name="twitter:card" content="summary">
			<meta name="twitter:site" content="@littleweaverweb">
		
	<meta property="og:type" content="article" />
	
	
		<meta name="twitter:creator" content="@pythonburrows" />
	
	
		<meta property="og:description" content="If you notice that your Django application is running slowly, the first place I always recommend looking is at how many SQL queries you’re running. Even in simple applications, there are likely to be easy opportunities to reduce your query count that result in a significant performance improvement. In this blog post I’ll cover some common pitfalls, some best practices, and how to measure the number of queries you’re making." />
		<meta name="description" content="If you notice that your Django application is running slowly, the first place I always recommend looking is at how many SQL queries you’re running. Even in simple applications, there are likely to be easy opportunities to reduce your query count that result in a significant performance improvement. In this blog post I’ll cover some common pitfalls, some best practices, and how to measure the number of queries you’re making." />
	


		<title>Query count pitfalls and how to avoid them
</title>

		<link rel="stylesheet" href="/static/CACHE/css/4beb28c1c3d9.css" type="text/css" />
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

		<script type="text/javascript" src="//use.typekit.net/kir3awt.js"></script>
		<script type="text/javascript">try{Typekit.load();}catch(e){}</script>

		
		<link rel="apple-touch-icon" sizes="57x57" href="/static/img/favicons/apple-touch-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="/static/img/favicons/apple-touch-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="/static/img/favicons/apple-touch-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="/static/img/favicons/apple-touch-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="/static/img/favicons/apple-touch-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="/static/img/favicons/apple-touch-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="/static/img/favicons/apple-touch-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="/static/img/favicons/apple-touch-icon-152x152.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/static/img/favicons/apple-touch-icon-180x180.png">
		<link rel="icon" type="image/png" href="/static/img/favicons/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="/static/img/favicons/android-chrome-192x192.png" sizes="192x192">
		<link rel="icon" type="image/png" href="/static/img/favicons/favicon-96x96.png" sizes="96x96">
		<link rel="icon" type="image/png" href="/static/img/favicons/favicon-16x16.png" sizes="16x16">
		<link rel="manifest" href="/static/img/favicons/manifest.json">
		<link rel="mask-icon" href="/static/img/favicons/safari-pinned-tab.svg" color="#5bbad5">
		<meta name="msapplication-TileColor" content="#da532c">
		<meta name="msapplication-TileImage" content="/static/img/favicons/mstile-144x144.png">
		<meta name="theme-color" content="#ffffff">
		
			<script>
				(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
				})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

				ga('create', 'UA-52154832-3', 'auto');
				ga('send', 'pageview');
			</script>
		
	</head>
	<body class="no-banner">

		
	<header class="site-header compact-header">
		<div class="container">
			<div class="row">
				<div class="col-xs-3 col-md-2">
					<div class="header-logo">
						<a href="/">
							<img src="/static/img/logo.svg" alt="Little Weaver Logo" class="header-logo-img header-logo-img--compact" />
						</a>
					</div>
				</div>
				<div class="col-xs-9 col-md-10">
					<div class='clearfix'>
						<ul class="nav nav-pills nav--lw nav--white pull-left  hidden-sm-only">
							<li class="nav-item"><a href="/" class="nav-link nav-link-special">Little Weaver Web Collective</a></li>
						</ul>
						<ul class="nav nav-pills nav--lw nav--white pull-sm-right nav--lw--links">
	
		<li class="nav-item"><a class="nav-link" href="/services/">Services</a></li>
		<li class="nav-item"><a class="nav-link" href="/work/">Work</a></li>
		<li class="nav-item"><a class="nav-link" href="/blog/">Blog</a></li>
		<li class="nav-item"><a class="nav-link" href="/about/">About</a></li>
	
</ul>

					</div>
				
				</div>
			</div>
		</div>
	</header>
	<main>
		
	

	<div class="container m-r-1-sm-only">
		<div class="row m-y-2">
			<div class='col-sm-8 col-sm-offset-3 col-md-10 col-md-offset-2 col-lg-8'>
				<h1 class="color-black-almost">Query count pitfalls and how to avoid them</h1>

				
				<div>
					<span class="color-black-almost">
						
                            <a href="/about/stephen-burrows">
                                Stephen Burrows
                            </a>
						
					</span>
					<span class="dateline">
						<time datetime="2018-01-23">Jan. 23, 2018</time>
					</span>
				</div>

			</div>
		</div>

		<main class='blog-content m-b-3'>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p></p><p>If you notice that your Django application is running slowly, the first place I always recommend looking is at how many SQL queries you’re running. Even in simple applications, there are likely to be easy opportunities to reduce your query count that result in a significant performance improvement. In general, reducing query count can improve your performance because every query spends a certain amount of time traveling to and from the database server. In this blog post I’ll cover some common pitfalls, some best practices, and how to measure the number of queries you’re making.<br/></p><h2>Models &amp; examples</h2><p>These are the models and utilities we’ll be using in the examples in this post.<br/></p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="c"># models.py</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">Tag</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">BlogPost</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;posts&#39;</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Author</span><span class="p">)</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Tag</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>The following helper uses the <a href="https://faker.readthedocs.io/en/latest/index.html">Faker</a> library to create fake data.</p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="c"># examples.py</span>
<span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Faker</span>

<span class="n">fake</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">create_blog_posts</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">fake</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
        <span class="n">BlogPost</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">fake</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
            <span class="n">blog</span><span class="o">=</span><span class="n">blog</span><span class="p">,</span>
            <span class="n">author</span><span class="o">=</span><span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">fake</span><span class="o">.</span><span class="n">name</span><span class="p">()),</span>
        <span class="p">)</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>I’ll also be using a <code>rollback</code>  decorator to make sure the database is always left in a clean state after an example is run, and a <code>count_queries()</code>  context manager which counts the queries executed within its scope and prints that count to stdout.</p><p>You can find the code for these helpers and models, as well as all the examples, on <a href="http://github.com/littleweaver/query-count-post">Github</a>, or install it locally on your machine as follows:</p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="nv">$ </span>pip install pipenv <span class="c"># if pipenv is not already installed on your system</span>
<span class="nv">$ </span>git clone https://github.com/littleweaver/query-count-post.git
<span class="nv">$ </span><span class="nb">cd </span>query-count-post
<span class="nv">$ </span>pipenv install
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>Examples are found inside the repository at <code>query_count/examples.py</code>. To run an example, you can do the following from the repository root:</p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="nv">$ </span>pipenv shell
<span class="nv">$ </span>python manage.py shell
&gt;&gt;&gt; from query_count.examples import following_foreignkeys__small
&gt;&gt;&gt; following_foreignkeys__small<span class="o">()</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><h2>Common pitfalls</h2><p>There are a number of ways that it’s easy to unintentionally inflate your query count when working with Django models. I’m going to run through some of the most common scenarios and show you how to fix them.<br/></p><h3>Following ForeignKeys</h3><p>One of the most common things you will do in Django is follow ForeignKey  relationships. It’s super easy, but it silently adds a query every time you do it. Take the following example:<br/></p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="nd">@rollback</span>
<span class="k">def</span> <span class="nf">following_foreignkeys__small</span><span class="p">():</span>
    <span class="n">create_blog_posts</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">count_queries</span><span class="p">():</span>
        <span class="n">blog_post</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="n">blog_post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>In the example above, two queries will be executed: one to get the (only) blog post, and one in the background when the blog post’s author is accessed. We can eliminate the second query by using <code><a href="https://docs.djangoproject.com/en/2.0/ref/models/querysets/#select-related">select_related</a></code>, a QuerySet method that lets us fetch related object data without needing additional queries.</p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="nd">@rollback</span>
<span class="k">def</span> <span class="nf">following_foreignkeys__small__select_related</span><span class="p">():</span>
    <span class="n">create_blog_posts</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">count_queries</span><span class="p">():</span>
        <span class="n">blog_post</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="err">‘</span><span class="n">author</span><span class="err">’</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="n">blog_post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>This version of the code only executes one query: getting the blog post. The author data is fetched at the same time, and cached on the blog post before we try to access it.</p><p>Select related shines even more with larger data sets. For example, suppose we wanted to display the author names for 300 blog posts. Here’s an example without <code>select_related</code>:<br/></p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="nd">@rollback</span>
<span class="k">def</span> <span class="nf">following_foreignkeys__large</span><span class="p">():</span>
    <span class="n">create_blog_posts</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">count_queries</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">blog_post</span> <span class="ow">in</span> <span class="n">BlogPost</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="n">blog_post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>Without <code>select_related</code> , we will end up executing 301 queries - one to get the posts, and then one query per post to get the related author. We can tweak this just a bit with select related:</p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="nd">@rollback</span>
<span class="k">def</span> <span class="nf">following_foreignkeys__large__select_related</span><span class="p">():</span>
    <span class="n">create_blog_posts</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">count_queries</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">blog_post</span> <span class="ow">in</span> <span class="n">BlogPost</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s">&#39;author&#39;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">blog_post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>Now suddenly we’re getting all that data with only a single query!</p><h3>Following ManyToManyFields &amp; reverse ForeignKeys<br/></h3><p><code>select_related</code>  is great, but it only works for following ForeignKeys from the model they’re defined on to the model they point to (for example <b>from</b> blog post <b>to</b> author). It doesn’t work going the opposite direction, and it doesn’t work for ManyToManyFields. So take an example where you’re printing all the tags for each blog post:</p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="nd">@rollback</span>
<span class="k">def</span> <span class="nf">following_m2m</span><span class="p">():</span>
    <span class="n">create_blog_posts</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">count_queries</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">blog_post</span> <span class="ow">in</span> <span class="n">BlogPost</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">blog_post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">all</span><span class="p">())))</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>This will execute 301 queries, just like the example above where author wasn’t <code>select_related</code>. Unfortunately we can’t eliminate all 301 queries. But we can still reduce the count with <code><a href="https://docs.djangoproject.com/en/2.0/ref/models/querysets/#prefetch-related">prefetch_related</a></code>. <code>prefetch_related</code>  executes one query for the primary queryset, then one additional query for each set of prefetched data, then caches the prefetched values on your model instances for later. Take the following code:</p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="nd">@rollback</span>
<span class="k">def</span> <span class="nf">following_m2m__prefetch_related</span><span class="p">():</span>
    <span class="n">create_blog_posts</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">count_queries</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">blog_post</span> <span class="ow">in</span> <span class="n">BlogPost</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="s">&#39;tags&#39;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">blog_post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">all</span><span class="p">())))</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>Even though we’re still using <code>blog_post.tags.all()</code> like before, this time we'll access the prefetched data on each object instead of running new queries, leaving us with a query count of just two!</p><br/><p>You can also combine <code>prefetch_related</code>  and <code>select_related</code>  using <code>Prefetch</code>  objects. For example, let’s say you want to display a list of blog posts with the name of their blog for each author. Here’s a basic implementation:</p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="nd">@rollback</span>
<span class="k">def</span> <span class="nf">following_reverse_fk</span><span class="p">():</span>
    <span class="n">create_blog_posts</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">count_queries</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">author</span> <span class="ow">in</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="n">author</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">blog_post</span> <span class="ow">in</span> <span class="n">author</span><span class="o">.</span><span class="n">blogpost_set</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="k">print</span><span class="p">(</span><span class="n">blog_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;||&#39;</span><span class="p">,</span> <span class="n">blog_post</span><span class="o">.</span><span class="n">blog</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>The setup for this example will create three hundred authors, each with one blog post, each of which has one related blog. So the code above will execute 601 queries as written. If we tweak things just a bit:</p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="nd">@rollback</span>
<span class="k">def</span> <span class="nf">following_reverse_fk__prefetch_related__select_related</span><span class="p">():</span>
    <span class="n">create_blog_posts</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">count_queries</span><span class="p">():</span>
        <span class="n">authors</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span>
            <span class="n">Prefetch</span><span class="p">(</span>
                <span class="s">&#39;blogpost_set&#39;</span><span class="p">,</span>
                <span class="n">queryset</span><span class="o">=</span><span class="n">BlogPost</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s">&#39;blog&#39;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">author</span> <span class="ow">in</span> <span class="n">authors</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">author</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">blog_post</span> <span class="ow">in</span> <span class="n">author</span><span class="o">.</span><span class="n">blogpost_set</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="k">print</span><span class="p">(</span><span class="n">blog_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;||&#39;</span><span class="p">,</span> <span class="n">blog_post</span><span class="o">.</span><span class="n">blog</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>Getting the blog posts looks exactly the same, but thanks to to the <code>prefetch_related</code>  and <code>select_related</code> , we’re now back at two queries.</p><h3>Related object counts</h3><p>From time to time, you may find yourself wanting to count related objects - for example, if you want to know how many blog posts each author has written. Here’s a simple implementation:<br/></p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="nd">@rollback</span>
<span class="k">def</span> <span class="nf">related_object_count</span><span class="p">():</span>
    <span class="n">create_blog_posts</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">count_queries</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">author</span> <span class="ow">in</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="n">author</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;||&#39;</span><span class="p">,</span> <span class="n">author</span><span class="o">.</span><span class="n">blogpost_set</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>Here, again, we end up with 301 queries: one for the author queryset, and one for each author to get the number of posts that author has written. We can improve this by using <a href="https://docs.djangoproject.com/en/2.0/topics/db/aggregation/#generating-aggregates-for-each-item-in-a-queryset">Django’s <code>Count</code>  annotation</a>, which moves the count calculation work to the database and caches the returned value on the model instance.</p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="nd">@rollback</span>
<span class="k">def</span> <span class="nf">related_object_count__annotation</span><span class="p">():</span>
    <span class="n">create_blog_posts</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">count_queries</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">author</span> <span class="ow">in</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">blogpost_count</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;blogpost&#39;</span><span class="p">)):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">author</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;||&#39;</span><span class="p">,</span> <span class="n">author</span><span class="o">.</span><span class="n">blogpost_count</span><span class="p">)</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>Because the count is done on the database side, this ends up only costing a single query.</p><h3>Creating lots of model instances</h3><p>The basic way of making new model instances is to use <code>Model.objects.create()</code>. For example, if you’re creating a bunch of blog posts at once you might be doing something along these lines:<br/></p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="nd">@rollback</span>
<span class="k">def</span> <span class="nf">bulk_create</span><span class="p">():</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fake</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">fake</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>

    <span class="k">with</span> <span class="n">count_queries</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">300</span><span class="p">):</span>
            <span class="n">BlogPost</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fake</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span>
                <span class="n">blog</span><span class="o">=</span><span class="n">blog</span><span class="p">,</span>
                <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span>
            <span class="p">)</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>This ends up firing off a single insert query for every object we create – so 300 queries total. We can do better than that by using <code><a href="https://docs.djangoproject.com/en/2.0/ref/models/querysets/#bulk-create">Model.objects.bulk_create()</a></code>. For this method, you need to pass in an iterable of objects of the right type, and they’ll all be created with a single query.</p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="nd">@rollback</span>
<span class="k">def</span> <span class="nf">bulk_create__bulk_create</span><span class="p">():</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fake</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">fake</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>

    <span class="k">with</span> <span class="n">count_queries</span><span class="p">:</span>
        <span class="n">posts</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">BlogPost</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fake</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span>
                <span class="n">blog</span><span class="o">=</span><span class="n">blog</span><span class="p">,</span>
                <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">BlogPost</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">bulk_create</span><span class="p">(</span><span class="n">posts</span><span class="p">)</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p><code>bulk_create</code>  does have one big limitation: you won’t have access to the ids of the created rows in the database (unless you’re using Postgres and Django 1.10+). Without an id, the model instances you’ve created will not know that they have been saved to the database. This means that you won’t be able to create <code>ManyToMany</code>  connections with the instances, set <code>ForeignKeys</code>  to point to them, or call <code>instance.refresh_from_db()</code> . Plus, if you use <code>instance.save()</code> you will end up with a duplicate row. But as long as you have that caveat in mind, this can be a great way to save some queries.</p><h3>Updating field values based on field values</h3><p>There will be times when you want to update a field based on the value of another field. One classic example of this would be incrementing a “like” counter on a model instance. Here’s a basic implementation, where you get an instance, update the field value, and save the instance:<br/></p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="nd">@rollback</span>
<span class="k">def</span> <span class="nf">update_field_value</span><span class="p">():</span>
    <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fake</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>

    <span class="k">with</span> <span class="n">count_queries</span><span class="p">():</span>
        <span class="n">blog</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">blog</span><span class="o">.</span><span class="n">likes</span> <span class="o">=</span> <span class="n">blog</span><span class="o">.</span><span class="n">likes</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">blog</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>This takes two queries. But we can do better by using <a href="https://docs.djangoproject.com/en/2.0/ref/models/expressions/#f-expressions">“F objects”</a> provided by Django, that let us represent the current value of a field in the database as part of a query. This lets us do the following:</p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="nd">@rollback</span>
<span class="k">def</span> <span class="nf">update_field_value__f</span><span class="p">():</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fake</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>

    <span class="k">with</span> <span class="n">count_queries</span><span class="p">():</span>
        <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">blog</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="n">likes</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;likes&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>In this second example, we’re creating a filtered queryset (instead of getting a single object) and then telling the database to update all items in that queryset to increment the “likes” field by one. This does have the disadvantage of not giving you an updated instance to work with, but by delegating the update to the database we’re able to save a query and also avoid race conditions for simultaneous “likes”.</p><h2>Best practices</h2><p></p><p>Apart from the ways that Django can help you, there are also some best coding practices that can help keep your code clear and efficient.</p><h3>Avoid side effects</h3><p>There’s often a temptation with Django to execute queries in helper methods and properties on models. While this can in some cases make code DRYer, it comes at the cost of an increased likelihood that queries will be executed unintentionally, and perhaps unnecessarily. Take this example:</p><p></p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">post_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">blogpost_set</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>If we add this shortcut property to Author, people will start using <code>author.post_count</code>  without realizing that they’re triggering a query every time. And this is a simple case that only executes one query. It’s easy to end up with methods and properties that do a lot more work than this.</p><p>If you need access to data that can be fetched as part of a queryset, find a way to add that to the queryset directly, for example as part of generating the context for a template or as part of an API view. If you’re really needing that data on a regular basis, consider adding a <a href="https://docs.djangoproject.com/en/1.11/topics/db/managers/">custom manager method</a> or creating a helper function that executes the query the same way every time. But in general, it’s good to wait until you’re repeating a pattern at least three times before abstracting it out; premature DRYing can make code less clear and harder to maintain.</p><h3>Reuse querysets</h3><p>This is probably one of the areas where you’ll save the smallest number of queries, but it’s such an easy win and such a common mistake that I can’t leave it out.</p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="nd">@rollback</span>
<span class="k">def</span> <span class="nf">reuse_querysets</span><span class="p">():</span>
    <span class="n">create_blog_posts</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">count_queries</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;There are blogs!&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">blog</span> <span class="ow">in</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="k">print</span><span class="p">(</span><span class="n">blog</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>In the above example, <code>Blog.objects.all()</code>  is called twice, resulting in two queries. You can eliminate one of those queries by storing the queryset in a variable and using that variable from then on.</p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="nd">@rollback</span>
<span class="k">def</span> <span class="nf">reuse_querysets__reuse</span><span class="p">():</span>
    <span class="n">create_blog_posts</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">count_queries</span><span class="p">():</span>
        <span class="n">blogs</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">blogs</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;There are blogs!&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">blog</span> <span class="ow">in</span> <span class="n">blogs</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">blog</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>You can also do this inside Django templates by using the `{% with %}` template tag.</p><h3>Measuring query count</h3><p><a href="https://django-debug-toolbar.readthedocs.io/">Django Debug Toolbar</a> is an excellent tool. If you want to profile your queries inside Django views you need to be using it. It includes a panel that breaks down the number of SQL queries you’re executing, how long each query takes, which queries are duplicates, what line of code triggered each query, and more.</p><p>If you’re trying to optimize code outside of Django views, it’s a little trickier since it’s manual, but essentially what you want to do is:</p></div>
						</div>
					
				</div>
			
				<div class='row block-code'>
					
						<div class='col-xs-12 col-lg-8 col-lg-offset-1'>
							<div class="codehilite"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">connection</span>
<span class="n">connection</span><span class="o">.</span><span class="n">queries</span>
</pre></div>

						</div>
					
				</div>
			
				<div class='row block-rich_text'>
					
						<div class='col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6'>
							<div class="rich-text"><p>The connection.queries object contains a list of all executed queries, which you can inspect to get whatever information you need for your optimization.</p><h2>Conclusion</h2><p>When you’re using Django views, you can often increase the speed of the view by reducing the number of queries executed, using the APIs and techniques described here. The important question for any optimization, though, is whether it meets the needs of your project. If you’re already fast enough, or efficient enough, maybe you don’t need to do more work right now. And sometimes the functionality you’re building won’t allow for an optimization that would otherwise be obvious. For example, if you need to find out how many blog posts each author has that have “Django” in the title, there’s no way to get that information with just annotations before Django 2.0.</p>If you’re interested in learning more about optimizing Django’s database access, I recommend checking out Django’s <a href="https://docs.djangoproject.com/en/dev/topics/db/optimization/">database optimization docs</a>, which go into techniques beyond query count reduction. Good luck!</div>
						</div>
					
				</div>
			
		</main>

		
			<div class="row m-b-3">
				<div class="col-xs-12 col-sm-9 col-sm-offset-3 col-md-8 col-md-offset-2 col-lg-6">
					
						<div class="media">
							<div class="media-left p-r-1">
								
									
								<a href="/about/stephen-burrows">
									<img src="/media/images/little-weavers-2017-May25-216.f067a6c9.fill-150x150.jpg" alt="stephen.jpg" width=100 class="img-circle media-object"/>
								</a>
								
							</div>
							<div class="media-body">
								


<h4>
  <a href="/about/stephen-burrows">
	Stephen Burrows
  </a>
</h4>

	<div class="rich-text"><p>Stephen is an experienced Python engineer and server administrator based in Seattle, WA. He has been building and deploying Python/Django-based web applications for eight years.</p></div>


							</div>
						</div>
					
				</div>
			</div>
		


	</div>

	</main>


		<footer class="js-site-footer site-footer p-y-3">
			<div class="muted container">
				<div class="row">
					<div class="col-md-6">
						<a href="http://twitter.com/littleweaverweb" class="social-link color-gray-mid color-white-hover link-no-underline"><i class="fa fa-fw fa-lg fa-twitter"></i> <span class="sr-only">Twitter</span></a>
						<a href="http://facebook.com/littleweaverwebcollective" class="social-link color-gray-mid color-white-hover link-no-underline"><i class="fa fa-fw fa-lg fa-facebook-square"></i> <span class="sr-only">Facebook</span></a>
						<a href="http://github.com/littleweaver" class="social-link color-gray-mid color-white-hover link-no-underline"><i class="fa fa-fw fa-lg fa-github"></i> <span class="sr-only">GitHub</span></a>
					</div>
					<div class="col-md-6 text-md-right">
						<p>&copy; 2019  Little Weaver Web Collective, LLC.</p>
						<p><i class="fa fa-heart-o color-red"></i> Made with love.</p>
					</div>
				</div>
			</div>
		</footer>

		

		<script type="text/javascript">/*!
Waypoints - 4.0.0
Copyright © 2011-2015 Caleb Troughton
Licensed under the MIT license.
https://github.com/imakewebthings/waypoints/blob/master/licenses.txt
*/!function(){"use strict";function t(n){if(!n)throw new Error("No options passed to Waypoint constructor");if(!n.element)throw new Error("No element option passed to Waypoint constructor");if(!n.handler)throw new Error("No handler option passed to Waypoint constructor");this.key="waypoint-"+e,this.options=t.Adapter.extend({},t.defaults,n),this.element=this.options.element,this.adapter=new t.Adapter(this.element),this.callback=n.handler,this.axis=this.options.horizontal?"horizontal":"vertical",this.enabled=this.options.enabled,this.triggerPoint=null,this.group=t.Group.findOrCreate({name:this.options.group,axis:this.axis}),this.context=t.Context.findOrCreateByElement(this.options.context),t.offsetAliases[this.options.offset]&&(this.options.offset=t.offsetAliases[this.options.offset]),this.group.add(this),this.context.add(this),i[this.key]=this,e+=1}var e=0,i={};t.prototype.queueTrigger=function(t){this.group.queueTrigger(this,t)},t.prototype.trigger=function(t){this.enabled&&this.callback&&this.callback.apply(this,t)},t.prototype.destroy=function(){this.context.remove(this),this.group.remove(this),delete i[this.key]},t.prototype.disable=function(){return this.enabled=!1,this},t.prototype.enable=function(){return this.context.refresh(),this.enabled=!0,this},t.prototype.next=function(){return this.group.next(this)},t.prototype.previous=function(){return this.group.previous(this)},t.invokeAll=function(t){var e=[];for(var n in i)e.push(i[n]);for(var o=0,r=e.length;r>o;o++)e[o][t]()},t.destroyAll=function(){t.invokeAll("destroy")},t.disableAll=function(){t.invokeAll("disable")},t.enableAll=function(){t.invokeAll("enable")},t.refreshAll=function(){t.Context.refreshAll()},t.viewportHeight=function(){return window.innerHeight||document.documentElement.clientHeight},t.viewportWidth=function(){return document.documentElement.clientWidth},t.adapters=[],t.defaults={context:window,continuous:!0,enabled:!0,group:"default",horizontal:!1,offset:0},t.offsetAliases={"bottom-in-view":function(){return this.context.innerHeight()-this.adapter.outerHeight()},"right-in-view":function(){return this.context.innerWidth()-this.adapter.outerWidth()}},window.Waypoint=t}(),function(){"use strict";function t(t){window.setTimeout(t,1e3/60)}function e(t){this.element=t,this.Adapter=o.Adapter,this.adapter=new this.Adapter(t),this.key="waypoint-context-"+i,this.didScroll=!1,this.didResize=!1,this.oldScroll={x:this.adapter.scrollLeft(),y:this.adapter.scrollTop()},this.waypoints={vertical:{},horizontal:{}},t.waypointContextKey=this.key,n[t.waypointContextKey]=this,i+=1,this.createThrottledScrollHandler(),this.createThrottledResizeHandler()}var i=0,n={},o=window.Waypoint,r=window.onload;e.prototype.add=function(t){var e=t.options.horizontal?"horizontal":"vertical";this.waypoints[e][t.key]=t,this.refresh()},e.prototype.checkEmpty=function(){var t=this.Adapter.isEmptyObject(this.waypoints.horizontal),e=this.Adapter.isEmptyObject(this.waypoints.vertical);t&&e&&(this.adapter.off(".waypoints"),delete n[this.key])},e.prototype.createThrottledResizeHandler=function(){function t(){e.handleResize(),e.didResize=!1}var e=this;this.adapter.on("resize.waypoints",function(){e.didResize||(e.didResize=!0,o.requestAnimationFrame(t))})},e.prototype.createThrottledScrollHandler=function(){function t(){e.handleScroll(),e.didScroll=!1}var e=this;this.adapter.on("scroll.waypoints",function(){(!e.didScroll||o.isTouch)&&(e.didScroll=!0,o.requestAnimationFrame(t))})},e.prototype.handleResize=function(){o.Context.refreshAll()},e.prototype.handleScroll=function(){var t={},e={horizontal:{newScroll:this.adapter.scrollLeft(),oldScroll:this.oldScroll.x,forward:"right",backward:"left"},vertical:{newScroll:this.adapter.scrollTop(),oldScroll:this.oldScroll.y,forward:"down",backward:"up"}};for(var i in e){var n=e[i],o=n.newScroll>n.oldScroll,r=o?n.forward:n.backward;for(var s in this.waypoints[i]){var l=this.waypoints[i][s],a=n.oldScroll<l.triggerPoint,h=n.newScroll>=l.triggerPoint,p=a&&h,u=!a&&!h;(p||u)&&(l.queueTrigger(r),t[l.group.id]=l.group)}}for(var c in t)t[c].flushTriggers();this.oldScroll={x:e.horizontal.newScroll,y:e.vertical.newScroll}},e.prototype.innerHeight=function(){return this.element==this.element.window?o.viewportHeight():this.adapter.innerHeight()},e.prototype.remove=function(t){delete this.waypoints[t.axis][t.key],this.checkEmpty()},e.prototype.innerWidth=function(){return this.element==this.element.window?o.viewportWidth():this.adapter.innerWidth()},e.prototype.destroy=function(){var t=[];for(var e in this.waypoints)for(var i in this.waypoints[e])t.push(this.waypoints[e][i]);for(var n=0,o=t.length;o>n;n++)t[n].destroy()},e.prototype.refresh=function(){var t,e=this.element==this.element.window,i=e?void 0:this.adapter.offset(),n={};this.handleScroll(),t={horizontal:{contextOffset:e?0:i.left,contextScroll:e?0:this.oldScroll.x,contextDimension:this.innerWidth(),oldScroll:this.oldScroll.x,forward:"right",backward:"left",offsetProp:"left"},vertical:{contextOffset:e?0:i.top,contextScroll:e?0:this.oldScroll.y,contextDimension:this.innerHeight(),oldScroll:this.oldScroll.y,forward:"down",backward:"up",offsetProp:"top"}};for(var r in t){var s=t[r];for(var l in this.waypoints[r]){var a,h,p,u,c,f=this.waypoints[r][l],d=f.options.offset,y=f.triggerPoint,g=0,w=null==y;f.element!==f.element.window&&(g=f.adapter.offset()[s.offsetProp]),"function"==typeof d?d=d.apply(f):"string"==typeof d&&(d=parseFloat(d),f.options.offset.indexOf("%")>-1&&(d=Math.ceil(s.contextDimension*d/100))),a=s.contextScroll-s.contextOffset,f.triggerPoint=g+a-d,h=y<s.oldScroll,p=f.triggerPoint>=s.oldScroll,u=h&&p,c=!h&&!p,!w&&u?(f.queueTrigger(s.backward),n[f.group.id]=f.group):!w&&c?(f.queueTrigger(s.forward),n[f.group.id]=f.group):w&&s.oldScroll>=f.triggerPoint&&(f.queueTrigger(s.forward),n[f.group.id]=f.group)}}return o.requestAnimationFrame(function(){for(var t in n)n[t].flushTriggers()}),this},e.findOrCreateByElement=function(t){return e.findByElement(t)||new e(t)},e.refreshAll=function(){for(var t in n)n[t].refresh()},e.findByElement=function(t){return n[t.waypointContextKey]},window.onload=function(){r&&r(),e.refreshAll()},o.requestAnimationFrame=function(e){var i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||t;i.call(window,e)},o.Context=e}(),function(){"use strict";function t(t,e){return t.triggerPoint-e.triggerPoint}function e(t,e){return e.triggerPoint-t.triggerPoint}function i(t){this.name=t.name,this.axis=t.axis,this.id=this.name+"-"+this.axis,this.waypoints=[],this.clearTriggerQueues(),n[this.axis][this.name]=this}var n={vertical:{},horizontal:{}},o=window.Waypoint;i.prototype.add=function(t){this.waypoints.push(t)},i.prototype.clearTriggerQueues=function(){this.triggerQueues={up:[],down:[],left:[],right:[]}},i.prototype.flushTriggers=function(){for(var i in this.triggerQueues){var n=this.triggerQueues[i],o="up"===i||"left"===i;n.sort(o?e:t);for(var r=0,s=n.length;s>r;r+=1){var l=n[r];(l.options.continuous||r===n.length-1)&&l.trigger([i])}}this.clearTriggerQueues()},i.prototype.next=function(e){this.waypoints.sort(t);var i=o.Adapter.inArray(e,this.waypoints),n=i===this.waypoints.length-1;return n?null:this.waypoints[i+1]},i.prototype.previous=function(e){this.waypoints.sort(t);var i=o.Adapter.inArray(e,this.waypoints);return i?this.waypoints[i-1]:null},i.prototype.queueTrigger=function(t,e){this.triggerQueues[e].push(t)},i.prototype.remove=function(t){var e=o.Adapter.inArray(t,this.waypoints);e>-1&&this.waypoints.splice(e,1)},i.prototype.first=function(){return this.waypoints[0]},i.prototype.last=function(){return this.waypoints[this.waypoints.length-1]},i.findOrCreate=function(t){return n[t.axis][t.name]||new i(t)},o.Group=i}(),function(){"use strict";function t(t){return t===t.window}function e(e){return t(e)?e:e.defaultView}function i(t){this.element=t,this.handlers={}}var n=window.Waypoint;i.prototype.innerHeight=function(){var e=t(this.element);return e?this.element.innerHeight:this.element.clientHeight},i.prototype.innerWidth=function(){var e=t(this.element);return e?this.element.innerWidth:this.element.clientWidth},i.prototype.off=function(t,e){function i(t,e,i){for(var n=0,o=e.length-1;o>n;n++){var r=e[n];i&&i!==r||t.removeEventListener(r)}}var n=t.split("."),o=n[0],r=n[1],s=this.element;if(r&&this.handlers[r]&&o)i(s,this.handlers[r][o],e),this.handlers[r][o]=[];else if(o)for(var l in this.handlers)i(s,this.handlers[l][o]||[],e),this.handlers[l][o]=[];else if(r&&this.handlers[r]){for(var a in this.handlers[r])i(s,this.handlers[r][a],e);this.handlers[r]={}}},i.prototype.offset=function(){if(!this.element.ownerDocument)return null;var t=this.element.ownerDocument.documentElement,i=e(this.element.ownerDocument),n={top:0,left:0};return this.element.getBoundingClientRect&&(n=this.element.getBoundingClientRect()),{top:n.top+i.pageYOffset-t.clientTop,left:n.left+i.pageXOffset-t.clientLeft}},i.prototype.on=function(t,e){var i=t.split("."),n=i[0],o=i[1]||"__default",r=this.handlers[o]=this.handlers[o]||{},s=r[n]=r[n]||[];s.push(e),this.element.addEventListener(n,e)},i.prototype.outerHeight=function(e){var i,n=this.innerHeight();return e&&!t(this.element)&&(i=window.getComputedStyle(this.element),n+=parseInt(i.marginTop,10),n+=parseInt(i.marginBottom,10)),n},i.prototype.outerWidth=function(e){var i,n=this.innerWidth();return e&&!t(this.element)&&(i=window.getComputedStyle(this.element),n+=parseInt(i.marginLeft,10),n+=parseInt(i.marginRight,10)),n},i.prototype.scrollLeft=function(){var t=e(this.element);return t?t.pageXOffset:this.element.scrollLeft},i.prototype.scrollTop=function(){var t=e(this.element);return t?t.pageYOffset:this.element.scrollTop},i.extend=function(){function t(t,e){if("object"==typeof t&&"object"==typeof e)for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}for(var e=Array.prototype.slice.call(arguments),i=1,n=e.length;n>i;i++)t(e[0],e[i]);return e[0]},i.inArray=function(t,e,i){return null==e?-1:e.indexOf(t,i)},i.isEmptyObject=function(t){for(var e in t)return!1;return!0},n.adapters.push({name:"noframework",Adapter:i}),n.Adapter=i}();(function(){'use strict';function throttle(fn,threshhold,scope){threshhold||(threshhold=250);var last,deferTimer;return function(){var context=scope||this;var now=+new Date,args=arguments;if(last&&now<last+threshhold){clearTimeout(deferTimer);deferTimer=setTimeout(function(){last=now;fn.apply(context,args);},threshhold);}else{last=now;fn.apply(context,args);}};}
var setStickyFooterHeight=throttle(function(){var footerElm=document.getElementsByClassName('js-site-footer');if(footerElm.length===0){return;}
var footerHeight=footerElm[0].offsetHeight;document.body.style.marginBottom=footerHeight+'px';},50);document.addEventListener('DOMContentLoaded',setStickyFooterHeight);window.addEventListener('resize',setStickyFooterHeight);(function(){var elm=document.getElementsByClassName('js-technology-pane-waypoint');if(elm.length===0){return;}
elm[0].className+=' animation-fade-in--pre';var waypoint=new Waypoint({element:elm[0],offset:'bottom-in-view',handler:function(){elm[0].className=elm[0].className.replace('animation-fade-in--pre','animation-fade-in--start')}});})();})();</script>
		
	</body>
</html>
